<!DOCTYPE html>
<html lang="en-US">
  <head><!-- general -->
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="description" content="A ZSH plugin for handling your keys." />
<meta name="robots" content="index, follow">
<meta name="author" content="Alex de Sousa
" />

<!-- title -->
<title>Oath: Don't Loose Your Keys! | Alex de Sousa's Blog</title>

<!--  canonical -->
<link rel="canonical" href="https://thebroken.link/oath-dont-loose-your-keys/"/>

<!-- favicon -->
<link rel="icon" type="image/x-icon" href="/favicon.ico">
<link rel="apple-touch-icon" sizes="180x180" href="/assets/favicon/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/assets/favicon/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/assets/favicon/favicon-16x16.png">
<link rel="manifest" href="/assets/favicon/site.webmanifest">
<link rel="mask-icon" href="/assets/favicon/safari-pinned-tab.svg" color="#FFFFFF">
<meta name="msapplication-TileColor" content="#FFFFFF">
<meta name="theme-color" content="#FFFFFF">

<!-- Google card -->
<meta itemprop="description" content="A ZSH plugin for handling your keys." />
<meta itemprop="image" content="https://thebroken.link/assets/img/oath-dont-loose-your-keys/keys.png" />

<!-- Facebook card -->
<meta property="og:type" content="website" />
<meta property="og:site_name" content="Alex de Sousa's Blog" />
<meta property="og:title" content="Oath: Don't Loose Your Keys!" />
<meta property="og:image" content="https://thebroken.link/assets/img/oath-dont-loose-your-keys/keys.png" />
<meta property="og:url" content="https://thebroken.link/oath-dont-loose-your-keys/" />
<meta property="og:description" content="A ZSH plugin for handling your keys." />

<!-- Twitter card -->
<meta name="twitter:title" content="Oath: Don't Loose Your Keys!" />
<meta name="twitter:description" content="A ZSH plugin for handling your keys." />
<meta name="twitter:image" content="https://thebroken.link/assets/img/oath-dont-loose-your-keys/keys.png" />
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image:alt" content="Alex de Sousa's Blog">
<meta name="twitter:site" content="@thebroken_link">

<!-- styles --><link rel="stylesheet"
      href="/assets/css/article.css?version=20191116"><!-- metadata --><script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "NewsArticle",
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://thebroken.link/oath-dont-loose-your-keys/"
  },
  "headline": "Oath: Don't Loose Your Keys!",
  "image": ["https://thebroken.link/assets/img/logo.png"],
  "datePublished": "2020-03-12T00:00:00+00:00",
  "dateModified": "2020-03-12T22:34:29+00:00",
  "author": {
    "@type": "Person",
    "name": "Alex de Sousa"
  },
  "description": "A ZSH plugin for handling your keys."
}
</script>
<!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-85600451-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-85600451-1', {'anonymize_ip':true});
  </script><script type="text/javascript" src="/assets/js/app.js"></script>
</head>
  <body>
    <div class="page">
      <div class="navigation"><a class="navigation-logo" href="/">
  <img class="logo-image"
       alt="Alex de Sousa's Blog"
       src="/assets/img/logo.png"/>
</a>
<nav class="navigation-bar"><a href="/"
       class="nav-link-inactive">Blog</a></nav>
</div>
      <div class="content">
        <article class="article"><div class="header">
  <h1 class="title">Oath: Don't Loose Your Keys!</h1><div class="header-info">
    <img class="header-info-child avatar"
         src="/assets/img/handle/alex.jpg"
         alt="Alex de Sousa
"/>
    <div class="header-info-child author">Alex de Sousa
</div>
    <div class="header-info-child read-time">1 min read</div>
    <a class="header-info-child share-button share-twitter"
       href="https://twitter.com/intent/tweet?text=A+ZSH+plugin+for+handling+your+keys.&url=https://thebroken.link/oath-dont-loose-your-keys/&via=thebroken_link"
       target="_blank">
    </a>
  </div></div>
<p>Recently, I needed to reset my phone. I spent some time backing up my pictures and documents. Everything was going great. But then, I hit a roadblock.</p>

<h2 id="the-problem">The problem</h2>

<p>One-time passwords have become very handy for logging into several sites from Twitter to Coinbase. This passwords are 6 digit tokens generated using the current time and a private key. I was using Google Authenticator for getting my one-time passwords. Sadly, this app does not provide a way to backup the private keys.</p>

<p>The damage was done. I couldn&#39;t retrieve the private keys, so I needed to regenerate all of them in every site individually. I thought about my future self dealing with the same issue and I knew I needed a sustainable solution.</p>

<p><img src="https://media.giphy.com/media/llbEoVMhkLngWlzVVa/giphy.gif" alt="Let&#39;s change the lightbulb"></p>

<h2 id="the-research">The research</h2>

<p>I wanted a one-time password solution that:</p>

<ul>
<li>Didn&#39;t rely on my phone or any app.</li>
<li>Could also be used in my computer.</li>
<li>Was offline (no private keys stored in the cloud).</li>
</ul>

<p>That&#39;s when I discovered <code>oathtool</code>: a command line tool for generating 6 digit tokens given a private key.</p>

<blockquote>
<p>I installed it using <code>sudo apt install oathtool</code></p>
</blockquote>

<p>Generating a 6 digit token with <code>oathtool</code> is as easy as doing the following:</p>
<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>oathtool <span class="nt">-b</span> <span class="nt">--totp</span> <span class="s1">'MyPrivateKey'</span>
798946
</code></pre></div>
<p>Discovering this tool was a good start, but I needed a good way of dealing with the private keys. Then I stumbled upon <a href="https://www.cyberciti.biz/faq/use-oathtool-linux-command-line-for-2-step-verification-2fa/">this article</a>. The author created two scripts:</p>

<ul>
<li>One for encrypting the private key into a file using <code>gpg2</code>.</li>
<li>One for decrypting the private key and retrieving the 6 digit token using <code>oathtool</code>.</li>
</ul>

<p>Additionally, the 6 digit token was automatically copied to the clipboard using <code>xclip</code>.</p>

<blockquote>
<p>I installed both tools by running <code>sudo apt install gnupg2 xclip</code></p>
</blockquote>

<p>I loved the solution! Though it had some flaws like storing temporarily an unencrypted file with the private key, it was a great idea :)</p>

<p><img src="https://media.giphy.com/media/Mjq9vmDuJlBKw/giphy.gif" alt="Great idea"></p>

<h2 id="the-plugin">The plugin</h2>

<p>I wrote <a href="https://github.com/alexdesousa/oath">Oath ZSH plugin</a> by gathering the best ideas from that article. I ended up with the following commands:</p>

<ul>
<li>Adding a private key:</li>
</ul>
<div class="highlight"><pre><code class="language-bash" data-lang="bash">   <span class="nv">$ </span>oath add twitter.com
   Private key:
   <span class="o">[</span>SUCCESS]  Key created <span class="k">for </span>twitter.com
</code></pre></div>
<ul>
<li>Showing a 6 digit token (it&#39;ll ask for the gpg password):</li>
</ul>
<div class="highlight"><pre><code class="language-bash" data-lang="bash">   <span class="nv">$ </span>oath twitter.com
   123456
   <span class="o">[</span>SUCCESS]  Code copied to clipboard
</code></pre></div>
<ul>
<li>Deleting a private key (it&#39;ll ask for the gpg password):</li>
</ul>
<div class="highlight"><pre><code class="language-bash" data-lang="bash">   <span class="nv">$ </span>oath delete twitter.com
   <span class="o">[</span>WARN]     Deleting /home/user/.oath/twitter.com/B743BC73B5F90E2305142D226BBCD02E89ABBC79.gpg.gpg
   <span class="o">[</span>WARN]     Deleting /home/user/.oath/twitter.com
   <span class="o">[</span>SUCCESS]  Key deleted <span class="k">for </span>twitter.com
</code></pre></div>
<p>The same private keys I added to <code>oath</code>, I also added them to my phone&#39;s Google Authenticator app. That way both, my computer and phone, generate the same 6 digit token at a given time.</p>

<p>The only difference is that now I can backup everything. I just need to copy the following folders:</p>

<ul>
<li><code>$HOME/.gnupg/</code>: GPG folder with all the gpg keys.</li>
<li><code>$HOME/.oath/</code>: Oath folder where all the private keys are stored.</li>
</ul>

<blockquote>
<p>For more info, visit <a href="https://github.com/alexdesousa/oath">Oath Github repository</a>.</p>
</blockquote>

<p><img src="https://media.giphy.com/media/Xd1EhywNhOjq5EPn5t/giphy.gif" alt="Safety"></p>

<h2 id="conclusion">Conclusion</h2>

<p>Though this solution might not be for everyone, it solves the problem I had. Now I can reset my phone at any time and not worrying about my private keys, because they&#39;re safely backed up.</p>

<p><img src="https://media.giphy.com/media/de0AlLgV7XTRhEudoL/giphy.gif" alt="The keys"></p>

<p>Happy hacking!</p>
</article><hr><div class="bio-info">
    <img class="bio-info-child bio-avatar"
         src="/assets/img/handle/alex.jpg"
         alt="Alex de Sousa
"/>
    <div class="bio-info-child author">Alex de Sousa
</div>
    <div class="bio-info-child bio-description"><a href="https://refillaqua.com">Refill Aqua</a> co-founder. Elixir alchemist. Tech enthusiast.
</div>
  </div><div class="boxes"><!-- Previous article --><div class="box">
  <img class="box-child box-image"
       alt="Skogsrå: Simplifying Your Elixir Configuration"
       src="https://thebroken.link/assets/img/skogsra-simplifying-your-elixir-configuration/skogsra.jpg"/>
  <span class="box-child box-read-time">5 min read</span>
  <a class="box-child box-title nav-link-inactive"
     href="/skogsra-simplifying-your-elixir-configuration/">Skogsrå: Simplifying Your Elixir Configuration</a>
  <span class="box-child box-description">Improving Elixir configurations for small and large projects.</span>
</div>
</div></div>
      <div class="footer"><div class="footer-copyright">
  <span class="by-alex-de-sousa"> Copyright 2020 Alex de Sousa</span>
</div>
<div class="footer-social-media">
  <a href="https://github.com/alexdesousa">
    <img class="social-media github"
        src="/assets/img/social/github.png"
        alt="Twitter"/>
  </a>
  <a href="https://twitter.com/thebroken_link">
    <img class="social-media twitter"
        src="/assets/img/social/twitter.png"
        alt="Twitter"/>
  </a>
</div>
</div>
    </div>
  </body>
</html>
